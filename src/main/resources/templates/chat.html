<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>LifeChallenge</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/>
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet"
          type="text/css"/>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
          type="text/css"/>
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="/css/styles.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js"></script> <!-- SockJS import 필요 -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script> <!-- Stomp import 필요 -->
    <script>
        function getAddrLoc(){
            var keyword = $("#keyword").val();

            // 적용예 (api 호출 전에 검색어 체크)
            if (!checkSearchedWord(keyword, $("#keyword").val().length)) {
                return ;
            }

            $.ajax({
                url :"/sample/getAddrApi.do"
                ,type:"post"
                ,data:$("#form").serialize()
                ,dataType:"json"
                ,success:function(jsonStr){
                    $("#list").html("");
                    var errCode = jsonStr.results.common.errorCode;
                    var errDesc = jsonStr.results.common.errorMessage;
                    if(errCode != "0"){
                        alert(errCode+"="+errDesc);
                    }else{
                        if(jsonStr != null){
                            makeListJson(jsonStr);
                        }
                    }
                }
                ,error: function(xhr, status, error){
                    alert("에러발생");
                }
            });
        }

        function makeListJson(jsonStr){
            var htmlStr = "";
            htmlStr += "<table>";
            $(jsonStr.results.juso).each(function(){
                htmlStr += "<tr>";
                htmlStr += "<td>"+this.roadAddr+"</td>";
                htmlStr += "<td>"+this.roadAddrPart1+"</td>";
                htmlStr += "<td>"+this.roadAddrPart2+"</td>";
                htmlStr += "<td>"+this.jibunAddr+"</td>";
                htmlStr += "<td>"+this.engAddr+"</td>";
                htmlStr += "<td>"+this.zipNo+"</td>";
                htmlStr += "<td>"+this.admCd+"</td>";
                htmlStr += "<td>"+this.rnMgtSn+"</td>";
                htmlStr += "<td>"+this.bdMgtSn+"</td>";
                htmlStr += "<td>"+this.detBdNmList+"</td>";
                /** API 서비스 제공항목 확대 (2017.02) **/
                htmlStr += "<td>"+this.bdNm+"</td>";
                htmlStr += "<td>"+this.bdKdcd+"</td>";
                htmlStr += "<td>"+this.siNm+"</td>";
                htmlStr += "<td>"+this.sggNm+"</td>";
                htmlStr += "<td>"+this.emdNm+"</td>";
                htmlStr += "<td>"+this.liNm+"</td>";
                htmlStr += "<td>"+this.rn+"</td>";
                htmlStr += "<td>"+this.udrtYn+"</td>";
                htmlStr += "<td>"+this.buldMnnm+"</td>";
                htmlStr += "<td>"+this.buldSlno+"</td>";
                htmlStr += "<td>"+this.mtYn+"</td>";
                htmlStr += "<td>"+this.lnbrMnnm+"</td>";
                htmlStr += "<td>"+this.lnbrSlno+"</td>";
                htmlStr += "<td>"+this.emdNo+"</td>";
                htmlStr += "</tr>";
            });
            htmlStr += "</table>";
            $("#list").html(htmlStr);
        }

        //특수문자, 특정문자열(sql예약어의 앞뒤공백포함) 제거
        function checkSearchedWord(input_keyword, keyword_length){
            const keyword = input_keyword;

            if(keyword_length >0){
                //특수문자 제거
                var expText = /[%=><]/ ;
                if(expText.test(keyword.value) == true){
                    alert("특수문자를 입력 할수 없습니다.") ;
                    keyword.value = keyword.value.split(expText).join("");
                    return false;
                }

                //특정문자열(sql예약어의 앞뒤공백포함) 제거
                var sqlArray = new Array(
                    //sql 예약어
                    "OR", "SELECT", "INSERT", "DELETE", "UPDATE", "CREATE", "DROP", "EXEC",
                    "UNION",  "FETCH", "DECLARE", "TRUNCATE"
                );

                var regex;
                for(var i=0; i<sqlArray.length; i++){
                    regex = new RegExp( sqlArray[i] ,"gi") ;

                    if (regex.test(keyword.value) ) {
                        alert("\"" + sqlArray[i]+"\"와(과) 같은 특정문자로 검색할 수 없습니다.");
                        keyword.value =keyword.value.replace(regex, "");
                        return false;
                    }
                }
            }
            return true ;
        }

        function enterSearch() {
            var evt_code = (window.netscape) ? ev.which : Event.keyCode;
            if (evt_code == 13) {
                Event.keyCode = 0;
                getAddrLoc();
            }
        }

        var stompClient = null;

        function setConnected(connected) {
            $("#connect").prop("disabled", connected);
            $("#disconnect").prop("disabled", !connected);
            if (connected) {
                $("#conversation").show();
            }
            else {
                $("#conversation").hide();
            }
            $("#greetings").html("");
        }

        function connect() {
            const socket = new SockJS('/gs-guide-websocket');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                setConnected(true);
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/greetings', function (greeting) {
                    showGreeting(JSON.parse(greeting.body).content);
                });
            });
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log("Disconnected");
        }

        function sendName() {
            stompClient.send("/app/hello", {}, JSON.stringify({'name': $("#name").val()}));
        }

        function showGreeting(message) {
            $("#greetings").append("<tr><td>" + message + "</td></tr>");
        }

        $(function () {
            $("form").on('submit', function (e) {
                e.preventDefault();
            });
            $( "#connect" ).click(function() { connect(); });
            $( "#disconnect" ).click(function() { disconnect(); });
            $( "#send" ).click(function() { sendName(); });
        });

    </script>
</head>
<body>
<!-- Navigation-->
<nav class="navbar navbar-light bg-light static-top">
    <div class="container">
        <a class="navbar-brand" href="#!">Life-Challenge</a>
    </div>
    <div>
        <a class="btn btn-primary" href="#signup" onclick="">로그인</a>
        <a class="btn btn-primary" href="#signup">회원가입</a>
    </div>
</nav>
<!-- Masthead-->
<header class="masthead">
    <div class="container position-relative">
        <div class="row justify-content-center">
            <div class="col-xl-6">
                <div class="text-center text-white">
                    <!-- Page heading-->
                    <h1 class="mb-5">chat page</h1>

                    <form class="form-subscribe" id="contactForm" data-sb-form-api-token="API_TOKEN">
                        <!-- Email address input-->
                        <div class="row">
                            <div class="col">
                                <input class="form-control form-control-lg" id="emailAddress" type="email"
                                       placeholder="Email Address" data-sb-validations="required,email"/>
                                <div class="invalid-feedback text-white" data-sb-feedback="emailAddress:required">Email
                                    Address is required.
                                </div>
                                <div class="invalid-feedback text-white" data-sb-feedback="emailAddress:email">Email
                                    Address Email is not valid.
                                </div>
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-primary btn-lg disabled" id="submitButton" type="submit">Submit
                                </button>
                            </div>
                        </div>
                        <!-- Submit success message-->
                        <!---->
                        <!-- This is what your users will see when the form-->
                        <!-- has successfully submitted-->
                        <div class="d-none" id="submitSuccessMessage">
                            <div class="text-center mb-3">
                                <div class="fw-bolder">Form submission successful!</div>
                                <p>To activate this form, sign up at</p>
                                <a class="text-white" href="https://startbootstrap.com/solution/contact-forms">https://startbootstrap.com/solution/contact-forms</a>
                            </div>
                        </div>
                        <!-- Submit error message-->
                        <!---->
                        <!-- This is what your users will see when there is-->
                        <!-- an error submitting the form-->
                        <div class="d-none" id="submitErrorMessage">
                            <div class="text-center text-danger mb-3">Error sending message!</div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</header>
<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being
    enabled. Please enable
    Javascript and reload this page!</h2></noscript>
<div id="main-content" class="container">
    <div class="row">
        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="connect">WebSocket connection:</label>
                    <button id="connect" class="btn btn-default" type="submit">Connect</button>
                    <button id="disconnect" class="btn btn-default" type="submit" disabled="disabled">Disconnect
                    </button>
                </div>
            </form>
        </div>
        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="name">What is your name?</label>
                    <input type="text" id="name" class="form-control" placeholder="Your name here...">
                </div>
                <button id="send" class="btn btn-default" type="submit">Send</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table id="conversation" class="table table-striped">
                <thead>
                <tr>
                    <th>Greetings</th>
                </tr>
                </thead>
                <tbody id="greetings">
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Footer-->
<footer class="footer bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 h-100 text-center text-lg-start my-auto">
                <ul class="list-inline mb-2">
                    <li class="list-inline-item"><a href="#!">About</a></li>
                    <li class="list-inline-item">⋅</li>
                    <li class="list-inline-item"><a href="#!">Contact</a></li>
                    <li class="list-inline-item">⋅</li>
                    <li class="list-inline-item"><a href="#!">Terms of Use</a></li>
                    <li class="list-inline-item">⋅</li>
                    <li class="list-inline-item"><a href="#!">Privacy Policy</a></li>
                </ul>
                <p class="text-muted small mb-4 mb-lg-0">&copy; Your Website 2022. All Rights Reserved.</p>
            </div>
            <div class="col-lg-6 h-100 text-center text-lg-end my-auto">
                <ul class="list-inline mb-0">
                    <li class="list-inline-item me-4">
                        <a href="#!"><i class="bi-facebook fs-3"></i></a>
                    </li>
                    <li class="list-inline-item me-4">
                        <a href="#!"><i class="bi-twitter fs-3"></i></a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#!"><i class="bi-instagram fs-3"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="/js/scripts.js"></script>
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<!-- * *                               SB Forms JS                               * *-->
<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
</body>
</html>